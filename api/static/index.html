<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Control</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<nav>
    <div class="brand">‚ö° Vercel Control</div>
    <div class="nav-links">
        <div class="nav-btn active" onclick="switchTab('explorer')">Explorer</div>
        <div class="nav-btn" onclick="switchTab('terminal')">Terminal</div>
        <div class="nav-btn" onclick="switchTab('testfly')">TestFly</div>
        <div class="nav-btn" onclick="switchTab('stats'); loadStats()">Monitor</div>
    </div>
</nav>

<main>
    <!-- EXPLORER -->
    <div id="explorer" class="view active">
        <div class="path-bar-container">
            <button class="btn" onclick="upDir()">‚¨Ü</button>
            <input class="path-input" id="addr" onchange="nav(this.value)">
            <button class="btn" onclick="refresh()">‚ü≥ Refresh</button>
            <span id="mode-badge" class="badge-snapshot">SNAPSHOT</span>
        </div>

        <div class="card">
            <div class="card-head">
                <div style="display:flex; gap:10px;">
                    <span style="cursor:pointer" onclick="setMode('runtime'); nav(window.SERVER_CONFIG.projectRoot)">üìÅ App Root</span>
                    <span style="color:var(--border)">|</span>
                    <span style="cursor:pointer" onclick="setMode('runtime'); nav('/')">üíª System</span>
                    <span style="color:var(--border)">|</span>
                    <span style="cursor:pointer" onclick="setMode('build'); nav(window.SERVER_CONFIG.projectRoot)">üèóÔ∏è Build Snapshot</span>
                </div>
                <span class="text-muted" style="font-size:11px">Double click to open</span>
            </div>
            <table style="margin-bottom: 0;">
                <thead><tr><th>Name</th><th>Size</th><th>Type</th><th style="text-align:right">Actions</th></tr></thead>
                <tbody id="file-list"></tbody>
            </table>
        </div>
    </div>

    <!-- TERMINAL -->
    <div id="terminal" class="view">
        <div class="terminal-window">
            <div class="term-out" id="term-out">Welcome to Vercel Shell v1.0\nType 'help' or any linux command.</div>
            <div class="term-in-row">
                <span class="term-ps">$</span>
                <input id="term-in" class="term-in" autocomplete="off" autofocus>
            </div>
        </div>
    </div>

    <!-- TESTFLY -->
    <div id="testfly" class="view">
        <div class="card">
            <div class="card-head">Job Configuration</div>
            <div class="card-body">
                <div class="grid-form">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Target URL</label>
                        <input id="fly-url" class="form-control" placeholder="https://youtube.com/watch?v=...">
                    </div>
                    
                    <div class="form-group">
                        <label>Provider</label>
                        <select id="fly-provider" class="form-control">
                            <option value="assemblyai">AssemblyAI</option>
                            <option value="deepgram">Deepgram</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mode</label>
                        <select id="fly-mode" class="form-control">
                            <option value="debug">Debug (Verbose)</option>
                            <option value="data">Data (JSON only)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Chunk Size</label>
                        <input id="fly-chunk" class="form-control" value="8M">
                    </div>
                    <div class="form-group">
                        <label>Limit Rate</label>
                        <input id="fly-limit" class="form-control" value="4M">
                    </div>
                    
                    <div class="form-group">
                        <label>Wait Time (s)</label>
                        <input id="fly-wait" class="form-control" value="2">
                    </div>
                    <div class="form-group">
                        <label>Player Clients</label>
                        <input id="fly-clients" class="form-control" value="tv,android,ios,web">
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Impersonate (Browser Target)</label>
                        <select id="fly-impersonate" class="form-control">
                            <option value="">None (Default)</option>
                            <option value="chrome-136:macos-15">Chrome 136 (macOS 15)</option>
                            <option value="chrome-133:macos-15">Chrome 133 (macOS 15)</option>
                            <option value="chrome-131:macos-14">Chrome 131 (macOS 14)</option>
                            <option value="chrome-124:macos-14">Chrome 124 (macOS 14)</option>
                            <option value="chrome-123:macos-14">Chrome 123 (macOS 14)</option>
                            <option value="chrome-120:macos-14">Chrome 120 (macOS 14)</option>
                            <option value="chrome-119:macos-14">Chrome 119 (macOS 14)</option>
                            <option value="chrome-116:windows-10">Chrome 116 (Windows 10)</option>
                            <option value="chrome-110:windows-10">Chrome 110 (Windows 10)</option>
                            <option value="chrome-107:windows-10">Chrome 107 (Windows 10)</option>
                            <option value="chrome-104:windows-10">Chrome 104 (Windows 10)</option>
                            <option value="chrome-101:windows-10">Chrome 101 (Windows 10)</option>
                            <option value="chrome-100:windows-10">Chrome 100 (Windows 10)</option>
                            <option value="chrome-99:windows-10">Chrome 99 (Windows 10)</option>
                            <option value="chrome-131:android-14">Chrome 131 (Android 14)</option>
                            <option value="chrome-99:android-12">Chrome 99 (Android 12)</option>
                            <option value="safari-26.0:macos-26">Safari 26.0 (macOS 26)</option>
                            <option value="safari-18.4:macos-15">Safari 18.4 (macOS 15)</option>
                            <option value="safari-18.0:macos-15">Safari 18.0 (macOS 15)</option>
                            <option value="safari-17.0:macos-14">Safari 17.0 (macOS 14)</option>
                            <option value="safari-15.5:macos-14">Safari 15.5 (macOS 14)</option>
                            <option value="safari-15.3:macos-14">Safari 15.3 (macOS 14)</option>
                            <option value="safari-26.0:ios-26.0">Safari 26.0 (iOS 26.0)</option>
                            <option value="safari-18.4:ios-18.4">Safari 18.4 (iOS 18.4)</option>
                            <option value="safari-18.0:ios-18.0">Safari 18.0 (iOS 18.0)</option>
                            <option value="safari-17.2:ios-17.2">Safari 17.2 (iOS 17.2)</option>
                            <option value="firefox-135:macos-14">Firefox 135 (macOS 14)</option>
                            <option value="firefox-133:macos-14">Firefox 133 (macOS 14)</option>
                            <option value="edge-101:windows-10">Edge 101 (Windows 10)</option>
                            <option value="edge-99:windows-10">Edge 99 (Windows 10)</option>
                            <option value="tor-14.5:macos-14">Tor 14.5 (macOS 14)</option>
                        </select>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>API Key (Optional if Env Var set)</label>
                        <input id="fly-key" class="form-control" type="password" placeholder="Key override...">
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>PoToken (Optional)</label>
                        <input id="fly-token" class="form-control" placeholder="web.gvs+...">
                    </div>
                    
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label>Cookies (Netscape Format)</label>
                        <textarea id="fly-cookies" class="form-control" placeholder="# Netscape HTTP Cookie File..."></textarea>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                            <input type="checkbox" id="fly-list-formats">
                            <span style="color:var(--accent)">List Formats Only (Do not download)</span>
                        </label>
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: right;">
                    <button class="btn btn-primary" onclick="runFly()">üöÄ Launch Job</button>
                </div>
            </div>
        </div>
        
        <div class="terminal-window" style="height: 300px;">
            <div class="term-out" id="fly-out" style="color:#a5d6ff">Job logs will appear here...</div>
        </div>
    </div>

    <!-- MONITOR -->
    <div id="stats" class="view">
        <div class="grid-form">
            <!-- System Info -->
            <div class="card">
                <div class="card-head">System Runtime</div>
                <div class="card-body" id="sys-info" style="font-size:12px; color:var(--text-muted); line-height:1.8">Loading...</div>
            </div>

            <!-- Storage -->
            <div class="card">
                <div class="card-head">Storage Usage</div>
                <div class="card-body" id="storage-list">Loading...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">Python Identity Check (Inodes)</div>
            <table class="table">
                <thead><tr><th>Path</th><th>Inode</th><th>Status</th></tr></thead>
                <tbody id="inode-list"></tbody>
            </table>
        </div>

        <div class="card">
            <div class="card-head">Toolchain Availability</div>
            <table>
                <thead><tr><th>Tool</th><th>Build Path</th><th>Runtime Path</th><th>Status</th></tr></thead>
                <tbody id="tool-comp-list"></tbody>
            </table>
        </div>

        <!-- ADD THIS NEW CARD -->
        <div class="card">
            <div class="card-head">Installed Python Packages</div>
            <div class="card-body">
                <pre id="pip-list-output" style="white-space: pre-wrap; font-family:var(--mono); font-size: 11px;">Loading...</pre>
            </div>
        </div>
    </div>

</main>

<!-- Modal -->
<div class="modal" id="file-modal">
    <div class="modal-box">
        <div class="modal-header">
            <span id="modal-title" style="font-weight:600">File Content</span>
            <button class="btn" onclick="closeModal()">Close</button>
        </div>
        <div class="modal-body" id="modal-text"></div>
    </div>
</div>

<!-- SERVER CONFIG INJECTION -->
<script>
    // This object is populated by ui.py before serving
    if (!window.SERVER_CONFIG) {
        window.SERVER_CONFIG = { projectRoot: "/" };
    }
</script>
<script src="/static/app.js"></script>
</body>
</html>
